# 停车场管理信息系统分析与设计

## 摘要
​	据公安2023年1月11日最新统计，2022年全国机动车保有量达4.17亿量，汽车占3.19亿量，其中新能源汽车保有量达1310万量，同比增长67.13%，呈高速增长态势。然而在城市化进程中，城市拥堵，找车位，停车难等问题也日益突出，传统停车场已无法完全满足智慧城市的需求。因此，如何解决这些问题并优化城市停车场管理信息系统成为一个亟需解决的问题。本文将分析，设计并实现一种针对目前问题的停车场管理信息系统，包含车牌识别，注册登陆，用户管理，预约车位等功能。本研究将对整体系统做系统设计，并对各功能模块做需求分析，使用C++，QT，MySQL，OpenCV等技术对停车场管理信息系统进行实现与分析。最后将对现行系统不足进行总结，并对未来智慧城市停车场信息系统进行展望。
## 关键字

## ABSTRACT
​	According to the latest statistics of public security on January 11, 2023, in 2022, the number of motor vehicles in China reached 417 million, and automobiles accounted for 319 million, among which the number of new energy vehicles reached 13.1 million, with a year-on-year growth of 67.13%, showing a rapid growth trend. However, in the process of urbanization, problems such as urban congestion, finding parking space and difficulty in parking have become increasingly prominent. Traditional parking lots have been unable to fully meet the needs of smart cities. Therefore, how to solve these problems and optimize the urban parking management information system has become an urgent problem. This paper will analyze, design and implement a parking management information system for the current problems, including license plate recognition, registration login, user management, parking reservation and other functions. This study will do the system design of the whole system, and do the demand analysis of each function module, using C++, QT, MySQL, OpenCV and other technologies to implement and analyze the parking lot management information system. Finally, the current system is summarized and the future smart city parking information system is prospected.
## Key Words

## 引言

​	根据国家发改委城市交通中心数据显示，2020年我国停车位缺口已超过8000万个，车位分布非常不均，停车场数据缺乏可视化，找车位，停车难问题等仍然是城市交通和居民生活中的痛点。随意停车不仅加剧城市交通拥堵与压力，而且深刻的影响城市居民生活幸福感。在智慧城市不断推动的背景下，路灯倒计时已经应用在地图导航APP当中，传统智慧停车场车位以专属APP融入城市专属APP当中，推动基础设备进入传统停车场。以专属APP的形式并不利于外地用户查询停车场数据，给智慧停车场提出更高的挑战。本课题将以停车场管理信息系统的分析与设计为主要研究对象，实现停车场管理信息系统的前后端实现，并在小程序端以最大的便捷性解决停车场车位查询与预定难问题。
## 一,系统分析(基本概念理论基础+)

​	系统分析是指对一个系统进行全面的研究和评估，以确定其功能，性能，质量和效率等方面的优点和缺陷，并提出改进和优化建议的过程。该过程包括对线性系统的文档化研究，需求分析，设计和开发方案等步骤。本章将通过业务流程和数据流程分析两个部分来对停车场管理信息系统进行研究与评估。

### (一), 业务流程

​	业务流程是为达到特定的价值目标而由不同的人分别共同完成一系列活动。停车场管理信息系统，有用户，终端设备，用户，停车场，管理信息系统多方面共同去最快的解决用户停车问题。

​	业务流程图(Transaction Flow Diagram,TFD)是一种描述管理系统内各单位，人员之间的业务关系，作业顺序和管理信息流向的图标。通过业务流程图能够更好的去描述整体停车场管理信息系统在运行过程中的业务处理过程。停车场管理信息系统业务流程图如下:
![停车场管理信息系统业务流程图](E:\parkingcar\Login\论文部分\老师要求\assets\停车场管理信息系统业务流程图.png)

​	管理员初次使用可以通过停车场管理信息系统注册账号，输入相关注册信息之后，系统将生成管理员账户表，并将管理员账户表以表格的形式存入数据库当中生成账户存档。当登录系统时，首先要进行数据库信息初始化，添加相关停车场信息，并生成停车场信息表，并将相关信息生成停车场存档。当用户开车入库的过程中，摄像头作为一个主体将为停车场管理信息系统提供车牌信息，将车牌输入到入库车辆表之后，管理员将决定车牌能够正确入库，并生成数据库表格，存入数据库车库存档当中。为满足用户未进入停车场提前预定车位的需求，设计了预定系统。通过停车场管理信息系统生成的入库车辆表生成对应的车库剩余数量，反馈给用户进行查询，当剩余车位充足的前提下即可进行预定车位并生成预定车位表，当用户准时到达车库时，并将用户车牌信息传入入库车辆表，根据管理员最后决定车辆信息并入库生成对应的车库存档。若用户并没有准时入库，相应预定车位表将在一定时间内进行注销。而当用户出库时，也将通过摄像头识别用户车牌信息，对照入库车辆表，根据前后对应的时间，计算用户需要支付的价格，最终完成整个停车场管理信息系统的业务流程。

### (二),数据流程分析

​	为了准确的将整个停车场管理信息系统的数据流动清晰的表示出来，本节将采用数据流程图的方式进行分析整个停车场管理信息系统。

​	数据流程图(Data Flow Diagram,DFD/Data Flow chart)简称数据流图，是一种描述系统数据流程的主要 工具，它用一组符号来描述整个系统中信息的全貌，综合地反映出信息在系统中流动，处理和存储情况。数据流图具有抽象和概括两个特征：数据流图把具体的组织机构，工作场所，物理流都去掉，仅反映信息和数据存储，流动，使用以及加工情况，而概括性是指流程图把各种业务的处理过程联系到一起进行考虑，形成一个总体。数据流程图采用自顶向下逐层分解的方法，把一个系统看成一个整体功能，明确信息的输入 与数据，系统为了实现这个功能，内部的信息处理，传递和存储全部通过下一级进行分析步骤，直到所有步骤都很具体为止。

#### 1，停车场管理信息系统数据流程图标总体设计

![数据流程图顶层图](E:\parkingcar\Login\论文部分\老师要求\assets\数据流程图顶层图.png)

​	管理员登录停车场管理信息系统，需要登录相关账号信息，用户可以将注册信息输入停车场管理信息系统，相关注册系统将生成注册登录表村存储到D2数据库当中。在初始化数据库的过程中，将停车场信息初始化并存储到D3数据库停车场信息表当中。当用户开车入库的时候，停车场管理信息系统会识别所需要的车辆信息信息，生成管理员所需要查询的入库车表，并根据车库总体车位情况，将剩余车位情况传送给需要查询车位剩余情况的用户，并根据用户停车时间前后差生成停车账单传递给用户。停车场管理信息系统将生成的停车车库表D1传入到数据库当中。

#### 2，停车场管理信息系统第一层分解数据流程图:

![停车管理信息系统第一层分解](E:\parkingcar\Login\论文部分\老师要求\assets\停车管理信息系统第一层分解.png)

​	停车场管理信息系统首先将管理员用户输入的账户信息进行注册管理并将生成的注册信息上传到D2注册登录表 当中，当用户登录成功之后才能够进行车辆信息管理审核。用户开车进入停车区域首先要进行车牌识别，然后进行时间处理记录当前的时间并将入库的时间和车牌号都交给收费处理，根据进入或离开完善收费信息，并将所有信息都传递给车辆信息管理进行整合生成完整的车辆信息，由管理员确认之后将车辆信息上传到停车车库表D1当中。当用户想要查询停车场剩余车位情况 时，将进入车位查询系统，由车辆信息管理将剩余车位反馈给车位查询系统并最终返回到用户当中。

#### 3，收费处理框分解

![收费处理框](E:\parkingcar\Login\论文部分\老师要求\assets\收费处理框.png)

​	收费管理处理框首先根据用户入库识别出来的车牌号，以及系统记录的识别时间，经过P6.1计算出入库时间和出库的时间差，然后从D3数据库当中读取到停车场停车单价，通过P6.2求出在此停车需要支付的价格，最后将入库信息和收费情况传递给P2车辆信息管理进行处理。

#### 4，车辆信息管理框分解

![车辆信息管理框](E:\parkingcar\Login\论文部分\老师要求\assets\车辆信息管理框.png)

​	车辆信息管理信息回根据P6收费处理传回的数据进行格式化整理，为形成数据库数据做准备，由管理员确认信息之后，将停车车辆信息上传到D1停车车库表当中，在上传停车车库表的同时并且同步数据库车库表现有的车位情况，并将现有车位传递给P3车位查询功能模块，方便用户实时的查询车位情况。

#### 5，车位查询框分解

![车位查询预约](E:\parkingcar\Login\论文部分\老师要求\assets\车位查询预约.png)

​	根据P2车辆信息管理返回的车位数量，根据用户提交的停车场名即可查看停车场的具体车位数量，然后将车位数量返回给用户，如果由车位的情况下，用户可以根据停车场去预定车位，并生成预约车表，将生成的预约车表信息传递给车辆信息管理进行车辆信息处理。

​	在本章综合分析了停车场管理信息系统的业务流程与数据处理流程，并对各个的处理过程进行细化，为 后续系统设计与 实现提供了基础与框架。



## 二,系统设计

​	

### (一)，功能模块式设计

#### 1，整体模块设计

​	根据停车场管理系统的使用场景，将停车场管理信息系统分为4个大模块  ，一个为首次登录系统所需要的初始化操作，包括数据库初始化，数据库相关表格与数据初始化。初始化之后，管理员需要登录相关账户方可进入停车场管理信息系统的主页面，即注册登录模块，以及防止管理员忘记密码所需要的修改密码模块。登录系统之后，进入车辆系统管理模块，此模块作为停车场管理信息系统的主体，车牌识别，入库出库，管理员确认识别车牌成功，并将相关车牌信息传入数据库。在基本出入库管理的基础上添加车库信息查询模块，管理员可以根据车牌号，根据时间段去查询车库停车的具体信息。于此同时管理员可以实时的查看停车场的车位状况，以及用户预约状况的可视化车库模块，还有方便管理管理员的账户管理模块。在用户未到达停车场之间，可以通过小程序实时查看停车场剩余车位的查询预定模块。整体功能设计图如下:

![整体模块设计](E:\parkingcar\Login\论文部分\老师要求\assets\整体模块设计.png)

#### 2，车库管理模块

![车辆管理模块](E:\parkingcar\Login\论文部分\老师要求\assets\车辆管理模块-1681023797040-3.png)

​	车库管理模块，管理员可以在停车场管理信息系统查看现有车库停车数量以及历史停车数量，管理员并且可以根据实际情况去修改车辆所在停车场以及出入库时间 等信息。并切可以根据需要删除车辆信息。



#### 3，账户管理模块

![账户管理模块](E:\parkingcar\Login\论文部分\老师要求\assets\账户管理模块.png)



​	账户管理模块分为遍历查看账户信息，修改账户信息，添加账户，删除账户操作，管理员可以一键管理所有用户账户信息。

#### 4，出库入库描述图

​	车辆入库和出库作为停车场管理信息系统的重要组成成分，本节将站在用户的角度用流程图描述车辆 入场和入场过程，以更加清晰的描述当车辆出入库时后台系统的运作过程。

##### （1），入库流程描述

​	停车场管理信息系统首先将检查停车场车库状况，若车库已满，则禁止车辆入场。当 车辆未满时将运行车辆入场 ，使用摄像头识别车牌作为其唯一标识，并对车牌合法性进行判断，如果车牌信息合法则将车牌和对应的时间点上传到数据库。如果车牌不合法则通知管理晕啊进行手动输入处理，处理完成之后，则开门运行车辆入场。

![车辆入场](E:\parkingcar\Login\论文部分\老师要求\assets\车辆入场-1681025177251-9.png)

##### （2），车辆出场流程描述

​	当车辆进入出场感应区域时，将用户出场时的识别信息与入场时进行信息对比，若信息一致，停车场管理信息系统 的计费功能将自动计算费用并进行支付。如果信息不符，则提示并通知管理处理，处理计费后进开门出场。

![车辆出场](E:\parkingcar\Login\论文部分\老师要求\assets\车辆出场-1681025109288-7.png)



### (二)，数据库设计

​	数据库设计(Database Design)是指对于一个给定的应用环境，构造最优的数据库模式，建立数据库及其应用系统，使之能够有效地存储数据，满足各种用户的应用需求(信息要求和处理要求)。优秀的数据库设计具有如下特点:
* 将信息划分到主题表中，以减少冗余数据

* 根据需要将表中的 信息链接在一起

* 确保信息的准确性和完整性

* 满足数据处理和报告需求

#### 1，需求分析

​	在管理员登录页，需要设计相关的用户数据库表，包含用户账户，密码，姓名等相关信息。。在数据库操作的过程中，主要包括用户账户密码的对应确认，以及用户表的注册，修改等操作。在车辆入场时需要将用户的车辆信息进行记录，并且要记录其入库的时间，等到其出库时还要记录出库时间，根据其出库时间与入库时间的差来计算用户停车费用，用户车辆信息表主要涉及创建，查询和添加等功能。而设计的停车场价格，就要根据不同的停车场具体而设定，所以需要设置一个停车场表，记录停车名称以及停车价格，为了方便用户通过小程序查询停车场车位状况，需要在停车场表内设置现有停车位以及总停车位数量，可以根据此表述实时的反映停车场车位使用状况。

#### 2，概念设计

​	E-R图(Entity-relationship model)为实体联系图，提供了表示实体型，属性和联系的方法，用来描述现实世界的概念模型。根据数据库需求分析得出ER图如下:

![数据库ER图](E:\parkingcar\Login\论文部分\老师要求\assets\数据库ER图-1681029204451-12.png)

​	汽车拥有汽车ID和车牌号两个属性，汽车与停车场形成一比一的关系，在同一时间段内一个汽车只能停在一个停车场内。停车场的属性包括停车场id，停车场名称，停车场现有容量，停车场总容量，停车费价格。于此同时管理员账户，一个管理员可以同时管理多个停车场，而管理员拥有管理员编号，管理员账户，管理员免密码，管理员姓名，管理员手机号多个属性。共同构成了停车场 管理信息系统的概念设计ER图。

#### 3，逻辑设计

将概念设计对应的ER图转换为管理模型为

管理员账户(管理员编号，账户，密码，姓名，手机号) 主键:管理员编号

汽车账户(汽车ID，车牌号) 主键:汽车ID

停车场账户(停车场id，停车场名称，现有容量，停车场走过容量，停车费价格)主键：停车场id

车辆进出记录(汽车id，停车场id，进入时间，离开时间，停车费用)主键:汽车id，停车场id



#### 4，物理设计(合适的数据库系统)

​	停车场管理信息系统将采用MySQL数据库，在处理大规模车辆入库信息与检索时，MySQL能够轻松地扩展以处理更大的数据量和更高的负载。并且MySQL数据库支持多种索引技术，对于车牌号，管理员账户的经常访问，使用其对应的索引技术拥有将会有更好的性能。

#### 5，实现

​	由于在实现过程中，车辆进出记录的经常与汽车账户一起使用，则在实现的过程中，不再将汽车账户与车辆进出记录分开设计，将汽车账户与车辆进出记录进行合并，共计三个表格，管理员账户表，停车场账户表，车辆信息表。实现代码如下

```sql
-- 创建数据库
CREATE DATABASE car;
-- 创建管理员账户表
CREATE TABLE
IF
	NOT EXISTS USER (
		id INT PRIMARY KEY AUTO_INCREMENT,
		username VARCHAR ( 255 ) UNIQUE NOT NULL,
		PASSWORD VARCHAR ( 255 ) NOT NULL,
		telephone VARCHAR ( 11 ) NOT NULL,
		truename VARCHAR ( 255 ) NOT NULL 
	);

-- 创建停车场信息表
CREATE TABLE
IF
	NOT EXISTS PARKING (
		P_id INT NOT NULL AUTO_INCREMENT,
		P_name VARCHAR ( 255 ) NOT NULL,
		P_now_count INT,
		P_all_count INT,
		P_fee DECIMAL ( 10, 2 ),
		PRIMARY KEY ( P_id ) 
	);

-- 创建汽车表
CREATE TABLE
IF
	NOT EXISTS CAR (
		id INT NOT NULL AUTO_INCREMENT,
		license_plate VARCHAR ( 20 ) NOT NULL,
		check_in_time DATETIME NOT NULL,
		check_out_time DATETIME DEFAULT NULL,
		fee DECIMAL ( 10, 2 ) DEFAULT NULL,
		location VARCHAR ( 20 ) NOT NULL,
		PRIMARY KEY ( id ),
	INDEX ( license_plate ) 
	);
```
## 三,系统实现
​	由于停车场管理信息系统对于摄像头等硬件设备的依赖，以及对底层多线程，高并发的要求。本停车场管理信息系统将基于window操作系统，采用C++11语言，使用QT5.12.1桌面开发框架，以CSS对桌面进行美化处理，使用OpenCV车牌识别技术对车牌进行识别，MySQL数据库存储数据。同时使用微信小程序作为用户端连接数据库查询剩余 停车场车位。

### (一)，界面设计

​	系统界面是指用户和计算机之间相互作用的面，是人与信息交互的媒介。停车场管理信息系统，即有面向管理人员的停车场管理信息系统以及面向用户的停车场查询订阅系统。无论是管理页面还是用户端都要突出界面设计的易用性，便捷性，高效性，以及让用户眼前一亮的创新性。

#### 1，登录注册页面

​	登录和注册页面均采用左图片右内容的布局形式。

![image-20230409172658882](E:\parkingcar\Login\论文部分\老师要求\assets\image-20230409172658882.png)

![image-20230409174639653](E:\parkingcar\Login\论文部分\老师要求\assets\image-20230409174639653.png)

#### 2，主页面

​	主页将摄像头数据以视频的形式将车牌信息呈现到主页当中。并根据识别的车牌决定入库与出库。在主页的上方将以饼图可视化的形式呈现出停车场车位使用情况。而右边是功能选项，可以选择车辆信息和管理页面。

![image-20230409174754274](E:\parkingcar\Login\论文部分\老师要求\assets\image-20230409174754274.png)

#### 3，账户管理页面

​	账户管理页面管理员可以直接在管理员信息表格当中修改用户数据，并点击修改按钮即可修改相关用户具体信息，而在最下面 的一空行，管理员可以直接输入对应信息，点击添加新用户之后即可将添加的用户信息上传到停车场管理信息系统的管理员数据表当中。而当用户鼠标点击某一行即可将某一行的数据进行删除，在管理员后端以最大的便捷性方便管理员管理账户信息。

![image-20230409174738974](E:\parkingcar\Login\论文部分\老师要求\assets\image-20230409174738974.png)

#### 4，停车信息管理页面

​	管理员可以在停车场信息管理页面查看所有停车信息，并且可以根据选择的时间段和车牌查看特定信息，并且可以对相关停车地点等具体信息做出修改并进行保存。

![image-20230409174815809](E:\parkingcar\Login\论文部分\老师要求\assets\image-20230409174815809.png)

#### 5，小程序查询预约设计









### (二)，主要代码

```cpp
//车辆入库将信息提交到数据库
void Car::on_submitCar_clicked()
{

    //读取车牌号
    QString license_plate = ui->Car_idinput->text(); //读取输入或识别出来的车牌号
    //获取当前的时间
    // 获取当前时间
    QDateTime currentDateTime = QDateTime::currentDateTime();
    // 将时间转换为字符串格式（格式化为 "yyyy-MM-dd hh:mm:ss"）存储到MySQL的database
    QString formattedDateTime = currentDateTime.toString("yyyy-MM-dd hh:mm:ss");
    //将信息上传到数据库
    //位置
    QString location = "新科停车场";

    QString sql_submitCar = QStringLiteral("INSERT INTO CAR (license_plate, check_in_time,location) VALUES ('%1','%2','%3');").arg(license_plate,formattedDateTime,location);

    if(mysql().execute_bool(sql_submitCar))
    {
        qDebug()<<"车牌数据插入成功";
        ui->Car_idinput->clear();  //清空输入框
        QMessageBox::information(this,"停车入库","车牌入库成功!");
    }
    else {
        qDebug()<<"车牌插入失败";
        qDebug()<<sql_submitCar;
        QMessageBox::information(this,"停车入库","车牌入库失败！！");

    }
}
//并获取用户在哪一行做出修改，然后根据用户ID更新用户信息
void Car::on_ButtonModify_clicked()
{
    //读取当前鼠标所在的行
    int row = ui->tablectrol->currentRow();
    qDebug()<<row;
    if(row>=0)
    {
        //读取行对应的数据
        QString ID = ui->tablectrol->item(row,0)->text(); //ID为只读，作为唯一标识符
        //读取其它信息
        QString username = ui->tablectrol->item(row,1)->text();
        QString password = ui->tablectrol->item(row,2)->text();
        QString telephone = ui->tablectrol->item(row,3)->text();
        QString truename = ui->tablectrol->item(row,4)->text();
        //输出信息测试
        //qDebug()<<ID<<username<<password<<telephone<<truename;

        //将读取到的数据更新到数据库
        QString encryptedPassword = encryptPassword(password); // 对密码进行加密
        QString sql_update = QStringLiteral("UPDATE USER SET username='%1', password='%2', telephone='%3',truename='%4' WHERE id='%5';").arg(username,encryptedPassword,telephone,truename,ID);
        QSqlQuery query;
        query.prepare(sql_update);
        if (query.exec()) {
            if (query.numRowsAffected() == 1) {
                qDebug() << "User updated successfully.";
                Car::on_CtrolButton_clicked(); //模拟点击，更新
            } else {
                qDebug() << "Could not update user with ID:" << ID;
            }
        } else {
            //检查执行语句
            qDebug()<<sql_update;
            qDebug() << "Error executing SQL statement:" ;
        }
    }

}
```

完整代码详见附录一



## 结束语

​	

## 参考文献:

[1] 罗仕鉴, 朱上上, 孙守迁.人机界面设计[M].北京:机械工业出版社, 2002.25-33.





## 附录

附录一



## 谢辞

